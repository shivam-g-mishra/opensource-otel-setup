# =============================================================================
# Prometheus Configuration
# =============================================================================
# Prometheus scrapes metrics from configured targets at regular intervals.
#
# To add your application's metrics:
#   1. Expose a /metrics endpoint in your app
#   2. Add a scrape_configs entry below
#   3. Restart Prometheus: docker compose restart prometheus
#
# =============================================================================

global:
  scrape_interval: 15s          # How often to scrape targets
  evaluation_interval: 15s      # How often to evaluate rules
  external_labels:
    monitor: 'otel-stack'       # Label added to all metrics

# Alertmanager configuration (optional - uncomment to enable)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets:
#           - alertmanager:9093

# Alerting rules - monitors the observability stack itself
rule_files:
  - /etc/prometheus/alerts/*.yml

scrape_configs:
  # ---------------------------------------------
  # Prometheus self-monitoring
  # ---------------------------------------------
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
    metrics_path: /metrics

  # ---------------------------------------------
  # OpenTelemetry Collector metrics
  # ---------------------------------------------
  - job_name: 'otel-collector'
    static_configs:
      - targets: ['otel-collector:8888']
    metrics_path: /metrics

  # ---------------------------------------------
  # Metrics exported by OTel Collector
  # (your application metrics flow through here)
  # ---------------------------------------------
  - job_name: 'otel-collector-exporter'
    static_configs:
      - targets: ['otel-collector:8889']
    metrics_path: /metrics

  # ---------------------------------------------
  # Your Application (uncomment and configure)
  # ---------------------------------------------
  # Option 1: Direct scraping (if your app exposes /metrics)
  # - job_name: 'my-app'
  #   static_configs:
  #     - targets: ['host.docker.internal:5001']  # Your app's metrics port
  #   metrics_path: /metrics
  #   # For .NET apps using OpenTelemetry:
  #   # metrics_path: /metrics

  # Option 2: Service discovery (for dynamic environments)
  # - job_name: 'kubernetes-pods'
  #   kubernetes_sd_configs:
  #     - role: pod
  #   relabel_configs:
  #     - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
  #       action: keep
  #       regex: true

  # ---------------------------------------------
  # Jaeger metrics (internal)
  # ---------------------------------------------
  - job_name: 'jaeger'
    static_configs:
      - targets: ['jaeger:14269']
    metrics_path: /metrics

  # ---------------------------------------------
  # Grafana metrics (optional)
  # ---------------------------------------------
  - job_name: 'grafana'
    static_configs:
      - targets: ['grafana:3000']
    metrics_path: /metrics

  # ---------------------------------------------
  # Loki metrics
  # ---------------------------------------------
  - job_name: 'loki'
    static_configs:
      - targets: ['loki:3100']
    metrics_path: /metrics

  # ---------------------------------------------
  # Node Exporter - Host metrics
  # ---------------------------------------------
  - job_name: 'node-exporter'
    static_configs:
      - targets: ['node-exporter:9100']
    metrics_path: /metrics
